<!-- Response Modal -->
<div 
    id="responseModal" 
    class="response-modal" 
    role="dialog" 
    aria-modal="true" 
    aria-labelledby="responseTitle"
    aria-describedby="responseDescription"
>
    <div class="modal-overlay" onclick="TryOutSidebar.closeResponseModal()"></div>
    <div class="modal-content">
        <!-- Modal Header -->
        <div class="modal-header">
            <div class="header-content">
                <h3 id="responseTitle">API Response</h3>
                <span id="responseDescription" class="visually-hidden">Displays the API response details and content</span>
                <div class="header-actions">
                    <button 
                        class="action-btn" 
                        onclick="copyResponse()" 
                        aria-label="Copy response"
                        data-tooltip="Copy to clipboard"
                    >
                        <span class="icon">ðŸ“‹</span>
                    </button>
                    <button 
                        class="action-btn" 
                        onclick="downloadResponse()" 
                        aria-label="Download response"
                        data-tooltip="Download as JSON"
                    >
                        <span class="icon">ðŸ’¾</span>
                    </button>
                    <button 
                        class="modal-close" 
                        aria-label="Close response modal" 
                        onclick="TryOutSidebar.closeResponseModal()"
                    >
                        <span class="icon">âœ•</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Response Stats -->
        <div class="response-stats">
            <div class="stat-group">
                <div class="stat-item">
                    <span class="stat-label">Status</span>
                    <span class="status-badge" id="modalStatusBadge"></span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Time</span>
                    <span class="stat-value" id="responseTime">0 ms</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Size</span>
                    <span class="stat-value" id="responseSize">0 KB</span>
                </div>
            </div>
            <div class="response-info" id="responseInfo"></div>
        </div>

        <!-- Response Content -->
        <div class="modal-body">
            <!-- Response Tabs -->
            <div class="response-tabs" role="tablist">
                <button 
                    class="tab active" 
                    role="tab" 
                    aria-selected="true"
                    aria-controls="responseBody"
                    data-tab="body"
                >
                    <span class="icon">ðŸ“„</span>
                    Response
                </button>
                <button 
                    class="tab" 
                    role="tab"
                    aria-selected="false"
                    aria-controls="responseHeaders"
                    data-tab="headers"
                >
                    <span class="icon">ðŸ“‹</span>
                    Headers
                </button>
                <button 
                    class="tab" 
                    role="tab"
                    aria-selected="false"
                    aria-controls="requestDetails"
                    data-tab="request"
                >
                    <span class="icon">ðŸ“¤</span>
                    Request
                </button>
            </div>

            <!-- Response Body Tab -->
            <div 
                id="responseBody" 
                class="tab-content active" 
                role="tabpanel"
            >
                <div class="response-toolbar">
                    <div class="toolbar-group">
                        <button 
                            class="tool-btn" 
                            onclick="formatResponse()"
                            data-tooltip="Format JSON"
                        >
                            <span class="icon">ðŸ”§</span>
                        </button>
                        <button 
                            class="tool-btn" 
                            onclick="collapseAll()"
                            data-tooltip="Collapse all"
                        >
                            <span class="icon">ðŸ“¦</span>
                        </button>
                        <button 
                            class="tool-btn" 
                            onclick="expandAll()"
                            data-tooltip="Expand all"
                        >
                            <span class="icon">ðŸ“‚</span>
                        </button>
                    </div>
                </div>
                <div class="response-viewer" role="region" aria-live="polite">
                    <div class="response-content" id="modalResponseBody" tabindex="0"></div>
                </div>
            </div>

            <!-- Response Headers Tab -->
            <div 
                id="responseHeaders" 
                class="tab-content" 
                role="tabpanel"
            >
                <div class="headers-list" id="responseHeadersList"></div>
            </div>

            <!-- Request Details Tab -->
            <div 
                id="requestDetails" 
                class="tab-content" 
                role="tabpanel"
            >
                <div class="request-details" id="requestDetailsList"></div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Tab switching
    const tabs = document.querySelectorAll('.response-tabs .tab');
    tabs.forEach(tab => {
        tab.addEventListener('click', () => switchTab(tab));
    });

    // Initialize syntax highlighting
    initializePrism();
});

function switchTab(tab) {
    // Remove active class from all tabs and content
    document.querySelectorAll('.response-tabs .tab').forEach(t => {
        t.classList.remove('active');
        t.setAttribute('aria-selected', 'false');
    });
    document.querySelectorAll('.tab-content').forEach(c => {
        c.classList.remove('active');
    });

    // Add active class to clicked tab and its content
    tab.classList.add('active');
    tab.setAttribute('aria-selected', 'true');
    const contentId = tab.getAttribute('aria-controls');
    document.getElementById(contentId).classList.add('active');
}

function copyResponse() {
    const responseText = document.getElementById('modalResponseBody').textContent;
    navigator.clipboard.writeText(responseText).then(() => {
        showToast('Response copied to clipboard');
    });
}

function downloadResponse() {
    const responseText = document.getElementById('modalResponseBody').textContent;
    const blob = new Blob([responseText], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'response.json';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function formatResponse() {
    try {
        const responseEl = document.getElementById('modalResponseBody');
        const json = JSON.parse(responseEl.textContent);
        responseEl.textContent = JSON.stringify(json, null, 2);
        Prism.highlightElement(responseEl);
    } catch (e) {
        showToast('Invalid JSON format');
    }
}

function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast';
    toast.textContent = message;
    document.body.appendChild(toast);
    setTimeout(() => {
        toast.remove();
    }, 3000);
}

</script>